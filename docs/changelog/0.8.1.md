# Server Health Refinement

## Overview
Refined the server health collection to include critical performance metrics: TPS (Ticks Per Second) and Memory Usage. These metrics are now displayed in the Server Health GUI.

## Changes
- **HealthSnapshot**: Added `tps`, `memoryUsed`, and `memoryMax` fields.
- **ServerHealthService**: Implemented collection of TPS (using `Bukkit.getTPS()`) and Memory usage (using `Runtime`).
- **ServerHealthGui**: Added display items for TPS (color-coded) and Memory Usage (MB).

## Technical Details
- **TPS**: Uses the 1-minute average from `Bukkit.getTPS()`. Color-coded: Green (>= 18), Yellow (>= 15), Red (< 15).
- **Memory**: Displays Used / Max memory in MB.

## Hot Chunks Analysis
- **Feature**: Added "Hot Chunks" detection to identify high-load areas.
- **Metrics**: Load is calculated based on Entity count + Tile Entity count (Hoppers, Redstone).
- **Ownership**:
  - Tracks block ownership for Tile Entities (Hoppers, etc.) using `PersistentDataContainer`.
  - Identifies "Top Owner" of a chunk based on Tameable entities and owned blocks.
- **GUI**: Added `HotChunksGui` to list top 10 hot chunks with teleport functionality.

---

## GUI System Enhancements

### New Features

#### Leaderboards GUI
- **Complete Implementation**: Leaderboards are now fully functional (previously placeholder).
- **7 Leaderboard Categories**:
  - Playtime
  - Total Kills (Player + Mob)
  - Player Kills
  - Deaths
  - Blocks Broken
  - Blocks Placed
  - Distance Traveled
- **Pagination**: Supports viewing large player lists with Previous/Next page navigation.
- **Category Switching**: Quick tabs at the top to switch between different stat categories.
- **Rank Indicators**: Gold/Silver/Bronze block icons for top 3 players.

#### Safe Teleportation
- **Fix**: HotChunksGui now uses `getHighestBlockYAt()` instead of hardcoded Y=100.
- **Safety**: Players teleport to the surface instead of potentially inside blocks or the void.

#### Teleport Confirmation
- **Feature**: Clicking a chunk now shows a confirmation prompt (5-second timeout).
- **Visual Feedback**: Item changes to green lime concrete during confirmation.
- **Safety**: Prevents accidental teleports from misclicks.

#### Refresh Functionality
- **ServerHealthGui**: Added refresh button (slot 26) to update server metrics without reopening.
- **PlayerStatsGui**: Added refresh button (slot 44) to reload player statistics.

#### Sound Effects
- **Click Sound**: All button clicks now play `UI_BUTTON_CLICK`.
- **Success Sound**: Refresh and teleport actions play `ENTITY_EXPERIENCE_ORB_PICKUP`.
- **Error Sound**: Permission denials play `ENTITY_VILLAGER_NO`.

#### Player Head Textures
- **MainMenuGui**: "My Stats" button now shows the player's actual head texture.
- **PlayerStatsGui**: Shows target player's head at top center of the GUI.
- **New Utility**: `GuiUtils.createPlayerHead()` for creating player skull items.

### Improvements

#### Enhanced Status Display
- **TPS Status**: Now shows status text (Excellent/Good/Fair/Poor) alongside value.
- **Memory**: Shows percentage used with color-coded indicator.
- **Cost Index**: Shows load status text (Low/Moderate/High/Critical).

#### Better Stat Formatting
- **Playtime**: Now shows "Xd Xh" format for long playtimes.
- **Distance**: Shows "m" for meters and "km" for kilometers.
- **Total Stats**: Shows sum totals (e.g., total kills, total distance).

#### Code Quality
- **GuiUtils**: Centralized utility class for GUI item creation and sounds.
- **Navigation**: Consistent back button positioning across all GUIs.
- **DRY Principle**: Shared `addNavigationButtons()` methods in GUIs.

### Test Coverage
- Added `LeaderboardsGuiTest` with 8 test cases covering:
  - Category button display
  - Player ordering by stats
  - Category switching
  - Navigation buttons
  - Pagination
  - All leaderboard types
- Updated existing GUI tests for new button positions and behaviors.
