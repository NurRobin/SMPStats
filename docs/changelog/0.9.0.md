# v0.9.0 - GUI Enhancements & Permissions

## Overview
Major GUI enhancements including health metric charts, entity management, configurable thresholds, and granular permission system.

## New Features

### Health Metric Charts
- **Visual Charts**: Primitive bar charts for all health metrics (TPS, Memory, Chunks, Entities, Hoppers, Redstone, Cost Index)
- **Time Scale Selection**: View history at 1m, 5m, 10m, or 1h intervals
- **Timestamps**: Each chart column shows the exact time the data was recorded
- **Configurable Thresholds**: Color-coded bars based on configurable good/acceptable/warning/critical thresholds
- **Refresh Button**: Manually trigger a new health sample

### Entity Management
- **Entity Breakdown GUI**: View all entity types across all worlds with counts
- **Entity Detail GUI**: Drill down to see individual entities of a specific type
- **Kill Entities**: Shift+Right-click to kill entities (with confirmation)
- **Teleport to Entities**: Left-click to teleport to any entity's location
- **Entity Heads**: Visual representation using appropriate mob heads/spawn eggs

### Configurable Health Thresholds
New `config.yml` section for customizing metric color thresholds:
```yaml
health:
  thresholds:
    tps:
      good: 19.0
      acceptable: 18.0
      warning: 15.0
      critical: 10.0
    entities:
      good: 500
      acceptable: 1500
      warning: 3000
      critical: 5000
    # ... more metrics
```

### Granular Permissions
New permission nodes for fine-grained access control:
- `smpstats.gui` - Access to GUI menu
- `smpstats.gui.stats` - View own statistics
- `smpstats.gui.stats.others` - View other players' statistics
- `smpstats.gui.leaderboard` - Access leaderboards
- `smpstats.gui.health` - Access Server Health
- `smpstats.gui.health.manage` - Kill entities and teleport
- `smpstats.admin` - Parent permission granting all of the above

See [docs/permissions.md](../permissions.md) for complete documentation.

## Improvements

### GUI Fixes
- **Server Health GUI**: Fixed showing stale/zero values on open
- **Hot Chunks GUI**: Fixed stale data when reopening
- **Main Menu GUI**: Added permission indicators for each menu item

### Code Quality
- Fixed BlockListenerTest ignoresBlocksWhenTrackingDisabled test
- Fixed unclear comment in SStatsCommand
- Added Javadoc to MainMenuGui
- Fixed entity iteration in ServerHealthService to avoid ConcurrentModificationException
- Fixed memory leak in ServerHealthService (ChunkSnapshot now stores extracted data, not Chunk references)

## Technical Changes

### New Classes
- `HealthThresholds` - Configurable threshold definitions for health metrics
- `HealthChartGui` - Visual chart display for health metrics
- `EntityAnalysisService` - Entity analysis and management
- `EntityBreakdownGui` - Entity type overview
- `EntityDetailGui` - Individual entity management
- `EntityHeadUtils` - Entity type to Material mapping

### Configuration
- Config version bumped to 5
- Added `health.thresholds` section with customizable thresholds for all metrics

### Database
- No schema changes

## Backward Compatibility
- Legacy `smpstats.health` permission still works (checked alongside `smpstats.gui.health`)
- Legacy `smpstats.admin` permission still works for entity management

## Migration Notes
- Existing configs will auto-upgrade to version 5
- New threshold settings will use sensible defaults
- No action required for existing installations
